<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="CEID Ubiquitous Computing Project 2021-22 client app demo">
  <meta name="author" content="Andreas Komninos">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <title>AR controller demo</title>

  <!-- necessary libraries to import -->
  <!-- basic A-FRAME library, use 1.2.0 because aframe-gui text doesn't show up with later versions -->
  <!-- see https://github.com/rdub80/aframe-gui/issues/64 -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <!-- ar.js library -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <!-- aframe-gui library -->
  <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
  <!-- dat-gui library (required by aframe-gui) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js" type="text/javascript"></script>

  <script>
    //example scripting for creating an overlaid (2D) UI
    window.onload = function () {
      document
        .querySelector(".say-hi-button")
        .addEventListener("click", function () {
          alert("Hi there!");
        });


    };

    //component registration for in-built events (this case, fired when marker is detected)
    AFRAME.registerComponent('markerhandler', {
      init: function () {
        this.el.sceneEl.addEventListener('markerFound', (evt) => {
          console.log("marker found");
          console.log(evt);
        })
      }
    });

    //example of adding a scene component (this case, mouse cursor and a UI widget) dynamically, after scene is loaded
    AFRAME.registerComponent('dynamic-elements', {
      init: function () {
              //best to define the mouse cursor after the scene initialisation, to get appropriate
              //viewport coordinates...
              const scene = AFRAME.scenes[0];
              const mouseCursor = document.createElement('a-entity');
              mouseCursor.setAttribute('cursor', 'rayOrigin: mouse; fuse: false');
              mouseCursor.setAttribute('raycaster', 'objects: [gui-interactable]');
              scene.appendChild(mouseCursor);

              const controlpanel = document.getElementById('thepanel');
              const widget = document.createElement('a-gui-label');
              widget.setAttribute('width', '1.25');
              widget.setAttribute('height', '0.25');
              widget.setAttribute('value', 'dynamic widget');
              widget.setAttribute('font-size', '0.15');
              widget.setAttribute('line-height', '0.3');
              widget.setAttribute('letter-spacing', '0.0');
              widget.setAttribute('margin', '0 0 0.1 0');
              controlpanel.appendChild(widget);
      },
    });

</script>

<!-- basic CSS -->
<style>
  .buttons {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 5em;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
  }

  .say-hi-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background: white;
    color: black;
    width: 4em;
    height: 2em;
  }
</style>

</head>
  <body style="margin : 0px; overflow: hidden;">
    <!-- html for the 2D UI -->
    <div class="buttons">
      <button class="say-hi-button">SAY HI!</button>
    </div>

    <!-- html for the setup of the AR environment -->
    <!-- everything needs to be in a scene -->
    <!-- 2D marker types found here https://github.com/nicolocarpignoli/artoolkit-barcode-markers-collection -->
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 4x4_BCH_13_9_3; emitevents:true;'
              gui-env dynamic-elements>
      <!-- scene should have a marker to detect, in this case, a simple HIRO marker -->
      <a-marker id ="themarker" type='barcode' value='5' markerhandler>
        <!-- over the marker, we display some GUI components, they need to be inside a container -->
            <a-gui-flex-container
              id = "thepanel"
        			flex-direction="column" justify-content="center" align-items="normal" component-padding="0.1"
        			opacity="0.6" width="1.75" height="3" panel-color="#fff" panel-rounded="0.1"
        			position="0 0.5 0" rotation="-90 0 0"
        		>
              <!-- html for each GUI component -->
              <a-gui-radio
                width="1.25" height="0.25"
                onclick="console.log('clickety click');"
                value="radio label"
                font-size="0.15"
                margin="0 0 0.05 0"
              >
              </a-gui-radio>

              <a-gui-label
        				width="1.25" height="0.25"
        				value="test label"
        				font-size="0.15"
        				line-height="0.4"
        				letter-spacing="0"
        				margin="0 0 0.05 0"
        			>
              </a-gui-label>

              <a-gui-toggle
                width="1.25" height="0.25"
                onclick="console.log('clickety click');"
                value="toggle label"
                font-size="0.15"
                margin="0 0 0.05 0"
              >
              </a-gui-toggle>

              <a-gui-slider
                width="1.25" height="0.25"
                onclick="console.log('clickety click');"
                percent="0.20"
                margin="0 0 0.05 0"
              >
              </a-gui-slider>
    		</a-gui-flex-container>
      </a-marker>

      <!-- if we didn't do the dynamic adding of this entity, this is where it would be declared
      <a-entity id="mouseCursor"> cursor="rayOrigin: mouse" raycaster="objects: [gui-interactable]"></a-entity>
      -->

      <!-- set the camera fov to 40 because the touch coordinates don't work well with the default (80)-->
      <!-- see https://github.com/AR-js-org/AR.js/issues/271 -->
      <a-entity camera="fov:40" id="cam" ></a-entity>
    </a-scene>
  </body>
</html>
